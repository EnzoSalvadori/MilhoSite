{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block title %}Envio de imagens{% endblock %}

{% block content %}
    <script type="text/javascript"> 
        var tipo_usuario = "{{user.premium}}";
        var espaco_usuario = "{{user.espaco}}";
        function valida_up() {
            var imagem = document.getElementById("imagem");
            var formato = imagem.value.split(".");
            formato = (formato[formato.length-1]).toUpperCase()
            console.log(formato)
            if (formato != "PNG" && formato != "TIF" && formato != "TIFF" && formato != "JPEG" && formato != "JPG"){
                alert("O arquivo enviado não possui um dos formatos suportados (PNG) (JPEG) (JPG) (TIF) (TIFF)");
                imagem.value = "";
                return;
            }
            if (tipo_usuario == "False"){
                if (imagem.files.item(0).size + parseInt(espaco_usuario) > 524288000){
                    alert("A imagem enviada ultaprassou seu limite de 500 Mb");
                    imagem.value = "";
                    return;
                }
            }else{
                if (imagem.files.item(0).size + parseInt(espaco_usuario) > 53687063712){
                    alert("A imagem enviada ultaprassou seu limite de 50 GB");
                    imagem.value = "";
                    return;
                }  
            }
        }
        function desabilita(){
            var botao = document.getElementById("botao");
            var imagem = document.getElementById("imagem");
            if (imagem.value == ""){
                alert("Por favor selecione um arquivo para envio");
                imagem.value = "";
                return;
            }
            botao.disabled = "disabled";
            botao.innerHTML = "Fazendo upload do arquivo aguarde ...";
            botao.form.submit();
        }
    </script>

    {% csrf_token %}
    {{ form|crispy }}
    <h3 class="text-center pt-5"> Sitema de detecção e contagem de plantas de milho</h3>
    <form method="POST" id="formID" enctype="multipart/form-data" class="mt-5 text-center">
        {% csrf_token %}
        {{ form|crispy }}
        <div class="drop-zone">
            <span class="drop-zone__prompt">Drop file here or click to upload</span>
            <input type="file" name="imagem" id="imagem" onchange="valida_up()" class="drop-zone__input">
        </div>
        <br>
        <button class="btn btn-primary px-5 mt-3" id="botao" type="submit" onclick="desabilita()">Enviar</button>
    </form>

    <script src="../static/main.js"></script>
{% endblock %}

